<!DOCTYPE html>
<html>
<head>
<title>bacondecomp.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<p>ECON 7175 – Econometrics III Spring 2020</p>
<p>Professor Patrick Button</p>
<p>Total points possible = 10</p>
<h2 id="center-diff-in-diff-with-vairation-in-treatment-timing---bacondecomp-in-statacenter"><center> Diff-in-Diff with Vairation in Treatment Timing - Bacondecomp In Stata</center></h2>
<h3 id="example">Example</h3>
<p>I believe you have learned Bacondecomp in class. Let's use the example from the Stata official help file. Please note, you need to install the package &quot;bacondecomp&quot; since it is not pre-installed in your Stata. (Off the topic a little bit: If you are using Stata Version 16, I encourage you to write your analysis and codes by using &quot;dyndoc&quot;, which is the Stata version of python's .ipynb file or R's .rmd file. This helps you manage your codes, outputs, and writings. You can find details on &quot;dyndoc&quot; <a href="https://www.stata.com/features/overview/markdown/">here</a>). Similar to other packages, this Stata command comes with a sample dataset. It is from a QJE paper - Stevenson and Wolfers (2006). First, we load the data from this package.</p>
<pre class="hljs"><code><div><span class="hljs-comment">/*
*********************************
Backondecomp Example
Jan. 2020, Ph.D. Econometrics III
*********************************
Package(s) to be installed
ssc install bacondecomp
*/</span>
<span class="hljs-comment">*Load data that replicates Stevenson and Wolfers' (2006) analysis of no-fault divorce reforms and female suicide.</span>
<span class="hljs-keyword">use</span> http:<span class="hljs-comment">//pped.org/bacon_example.dta</span>
</div></code></pre>
<p>I also have upload a copy of this dataset in <a href="https://www.dropbox.com/s/t24lbdz49bppga3/divorce.dta?dl=0">.dta</a> format as well as <a href="https://www.dropbox.com/s/baqlb7obf3teq95/divorce.csv?dl=0">.csv</a> format (click to download) if you could not load the data from online or you want to replicate the results using Stata.</p>
<pre class="hljs"><code><div><span class="hljs-comment">*Estimate a two-way fixed effect DD model of female suicide on no-fault divorce reforms.</span>
<span class="hljs-keyword">xtreg</span> asmrs <span class="hljs-keyword">post</span> pcinc asmrh cases i.year, fe robust

<span class="hljs-comment">*Apply the DD decomposition theorem in Goodman-Bacon (2018) to the two-way fixed effects DD model.</span>
bacondecomp asmrs <span class="hljs-keyword">post</span> pcinc asmrh cases, stub(Bacon_) robust

<span class="hljs-comment">*Request the detailed decomposition of the DD model.</span>
bacondecomp asmrs <span class="hljs-keyword">post</span> pcinc asmrh cases, ddetail
</div></code></pre>
<h3 id="problem-set">Problem Set</h3>
<p>The problem set will follow the paper - Cheng Cheng and Mark Hoekstra (2013). The authors estimate the effect of “castle doctrines,” state laws that make it easier to use lethal force in self-defense. The data set castle contains state/year level information from 2000-2010 on crime rates and whether or not the state had a castle doctrine in effect. Here we replicate the analysis on homicide rates. You can download the dataset <a href="https://github.com/zxecon/PhDEconometricsIII/blob/master/data/castlenew.dta">here</a>.</p>
<ol>
<li>
<p>(1 point) First of first, you need to install the package. Please include the code of how you install that. You may comment the code off if you want to re-run your do-file;</p>
</li>
<li>
<p>(1 point) Then, we look at the data from Cheng and Hoekstra (2013). The data is called castle.dta. Please let me know if you have difficulty in opening the dataset. Now you need to replicate the first column of Table 2, which calculate the mean of dependent variables;</p>
</li>
<li>
<p>(2 points) Now, we turn to the second column of Table 2. The authors present the weighted mean of the variables. Please use your own words to explain i) why do we need to add weight when we do empirical studies; b) what are the types weights in Stata, and what are the differences. Then you should replicate this second column of Table 2. (HINT: The dataset has a variable called &quot;population&quot; with 550 obs. You need to use this to create a population weight for each state.);</p>
</li>
<li>
<p>(2 points) Great. Now we have a preliminary impression of the dataset and the variables. Before we get into the paper, I would like to ask you questions about the difference-in-differences(DID). Please write your answers for a) What is DID and its benefits; b) what is(are) the key assumption(s) for ID estimation; c) What is Bacon decomposition and when should we use it; d) Please summarize the policy changes in Cheng and Hoekstra (2013).</p>
</li>
<li>
<p>(1 point) Now, you need to estimate fixed effects OLS panel data model. The model specification is on Page 11(or page 830) of this paper. Read through the model and understand what the differences across these specifications are. Since the specifications are similar within different outcome variables, you only need to replicate <strong>the first three columns for Larceny Rate in Table 3</strong>. (Hint: a)Since the dataset contains a lot of control variables, I list what you need to replicate in the following code b) The authors modify the indicator variable. Thus, in the regression, you should use 'cdl' as an indicator for policy change rather than 'post'.)</p>
</li>
</ol>
<pre class="hljs"><code><div><span class="hljs-keyword">global</span> var1 r20001-r20104 <span class="hljs-comment">//region-quarter fixed effects</span>
<span class="hljs-keyword">global</span> var2 l_police unemployrt poverty l_income l_prisoner l_lagprisoner blackm_15_24 whitem_15_24 blackm_25_44 whitem_25_44 spending l_exp_subsidy l_exp_pubwelfare <span class="hljs-comment">//other related controls</span>
</div></code></pre>
<ol start="6">
<li>(2 point) In the slides presented on the Stata Conference (<a href="https://github.com/zxecon/PhDEconometricsIII/blob/master/Goodman-Bacon%2C%20Nichols%2C%20Goldring%20-%202019%20-%20Bacon%20decomposition%20for%20understanding%20differences-in-differences%20with%20variation%20in%20treatment%20t.pdf">view the slides here</a>), on page 46, they used the 'bacondecomp' package in Stata to graph the bacon decomposition with the divorce data from Stevenson and Wolfers (2006). This is also what you see from the example in the Stata official help file. Try by your self to replicate this graph (no point, do not include in your final codes). a)Then, you should use data from Cheng and Hoekstra (2013) to construct a decomposition graph. The outcome variable is the same as what you use in Question 5. You need to perform the decomposition with time-varying controls. For this question, use the log of state/year level population (l_pop) and income (l_income) as controls .b) Briefly discuss the graph.</li>
</ol>
<ul>
<li>Bonus (1 point) In your future research, it is important to manipulate your graph in your codes. It is better than the graph editor. So, for the next step, please add a title (0.5 point), move the legend to the right of the graph, and change the colors of the plots (0.5). The image may look like <a href="https://github.com/zxecon/PhDEconometricsIII/blob/master/test.jpg">this</a>. (Hint: it is different to add titles/captions with the 'decomp' command from what you do with a 'twoway' command. You will not get the point if you do this in the graph editor.)</li>
</ul>
<h3 id="handing-in-the-assignment">Handing in the Assignment</h3>
<p>Please submit electronic copies of the following to me at zxie@tulane.edu. If you have any questions, feel free to e-mail me or submit the questions through Github (https://github.com/zxecon/PhDEconometricsIII).</p>
<ol>
<li>
<p>Your answers to the questions. This has just the answers in an organized format and not all the pages of output.</p>
</li>
<li>
<p>Your .do file for your code. Your .do file must be nicely annotated so that I can follow along with what you are doing (I will show you what I mean in class).</p>
</li>
<li>
<p>Your log file for your code (this log file saves all the output that appears on the screen).
Please submit this only once per group (max 3 students), and please CC your group members in the submission email.
Points will be deducted if you do not submit this properly or if there are problems with your files (e.g., you keep your log file open for other commands or for incorrect commands and Ziqi has to search through it to find your answers). If you do not annotate your do file then you will also lose points as well. Annotate here means that I want you to add comments to the Stata do file (using *) where, in these comments, you’ll explain what you are doing. This is useful for you later, when you go back to your code, and is also useful for others who may use your code (e.g., co- authors). It’s also becoming standard that you have to submit your data and code to get research published. So having organized code is required.
Handing in everything correctly and annotating your code nicely is worth 1 point.</p>
</li>
</ol>
<hr>
<h4 id="references">References:</h4>
<ul>
<li>
<p>Cheng Cheng, Mark Hoekstra, 2013. Does Strengthening Self-Defense Law Deter Crime or Escalate Violence? Evidence from Expansions to Castle Doctrine. The Journal of Human Resources Summer 2013 vol. 48 no. 3 821-854</p>
</li>
<li>
<p>Joshua Goodman, 2019.The Labor of Division: Returns to Compulsory High School Math Coursework. Journal of Labor Economics 37, no. 4 (October 2019): 1141-1182</p>
</li>
<li>
<p>Betsey Stevenson, Justin Wolfers, 2006. Bargaining in the Shadow of the Law: Divorce Laws and Family Distress. The Quarterly Journal of Economics, Volume 121, Issue 1, February 2006, Pages 267–288</p>
</li>
</ul>

</body>
</html>
